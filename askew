#!/usr/bin/env ruby

require 'yaml'
require 'todo-txt'
require 'pry'
require 'thor'

require_relative 'lib/config.rb'
require_relative 'lib/string.rb'

config_file = ENV['HOME'] + "/.askew/askew.config"

config = Config.new config_file 

if !config.valid?
  exit 1
else
  #puts "Loading config from #{config.path}"
  # should we not ask the user if they would like us to create one for them on first run?
end

class List < Thor
  
  desc "all", "List all tasks"
  def all
    begin
      puts "No definition found for ASKEW_TODO_LOCATION" if !ENV["ASKEW_TODO_LOCATION"]
      list = Todo::List.new ENV["ASKEW_TODO_LOCATION"]
      #puts list.by_priority "A"
      #binding.pry
      #puts list.sort_by { |task| task.priority }
      puts list.sort_by {|item| [item.priority ? 0 : 1, item.priority || 0]} # list by priorty with nulls at the end
    rescue
      puts "Unable to load your todo list."
    end
  end
  
  default_task :all

end

class Askew < Thor

  desc "hello NAME", "Say hello to NAME"
  def hello(name)
    puts "Hello #{name}"
  end

  desc "colortest", "Print pretty colors to the screen"
  def colortest
    puts "Color should be red".red
    puts "Non bold" + " text should be bold".bold + " Non Bold again."
  end

  desc "list", "List all the tasks"
  subcommand "list", List 

  default_task :list 
end

Askew.start(ARGV)

exit 0

